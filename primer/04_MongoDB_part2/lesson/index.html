<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Lessons for the Materials Project Workshop"><link href=https://workshop.materialsproject.org/primer/04_MongoDB_part2/lesson/ rel=canonical><link rel="shortcut icon" href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.1.2, mkdocs-material-5.5.0"><title>Advanced MongoDB - The Materials Project Workshop</title><link rel=stylesheet href=../../../assets/stylesheets/main.b5d04df8.min.css><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../../workshop.css><link rel=stylesheet href=../../../css/ansi-colours.css><link rel=stylesheet href=../../../css/jupyter-cells.css><link rel=stylesheet href=../../../css/pandas-dataframe.css></head> <body dir=ltr> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#mongodb-part-2 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://workshop.materialsproject.org title="The Materials Project Workshop" class="md-header-nav__button md-logo" aria-label="The Materials Project Workshop"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> The Materials Project Workshop </span> <span class="md-header-nav__topic md-ellipsis"> Advanced MongoDB </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/materialsproject/workshop/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://workshop.materialsproject.org title="The Materials Project Workshop" class="md-nav__button md-logo" aria-label="The Materials Project Workshop"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 2l-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5z"/></svg> </a> The Materials Project Workshop </label> <div class=md-nav__source> <a href=https://github.com/materialsproject/workshop/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. title=Home class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../../logistics/logistics/ title=Logistics class=md-nav__link> Logistics </a> </li> <li class=md-nav__item> <a href=../../../people/people/ title=People class=md-nav__link> People </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4 checked> <label class=md-nav__link for=nav-4> Primer <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label=Primer data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Primer </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../01_basic_python/0%20-%20Introduction%20and%20Jupyter%20Use/ title=Intro class=md-nav__link> Intro </a> </li> <li class=md-nav__item> <a href=../../01_basic_python/1%20-%20Python%20Primer/ title="Basic Python" class=md-nav__link> Basic Python </a> </li> <li class=md-nav__item> <a href=../../03_MongoDB_part1/lessons/ title="Intro to MongoDB" class=md-nav__link> Intro to MongoDB </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Advanced MongoDB <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg> </span> </label> <a href=./ title="Advanced MongoDB" class="md-nav__link md-nav__link--active"> Advanced MongoDB </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1-working-with-distinct-values-elemmatch-and-regex class=md-nav__link> 1: Working with Distinct Values, $elemMatch, and Regex </a> <nav class=md-nav aria-label="1: Working with Distinct Values, $elemMatch, and Regex"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#an-exceptional-laureate class=md-nav__link> An exceptional laureate </a> </li> <li class=md-nav__item> <a href=#using-distinct class=md-nav__link> Using .distinct() </a> </li> <li class=md-nav__item> <a href=#all-prize-categories-vs-those-with-multi-winners class=md-nav__link> All prize categories vs those with multi-winners </a> </li> <li class=md-nav__item> <a href=#distinct-example-born-here-went-there class=md-nav__link> Distinct example: Born here, went there </a> </li> <li class=md-nav__item> <a href=#enter-elemmatch class=md-nav__link> Enter $elemMatch </a> </li> <li class=md-nav__item> <a href=#elemmatch-example-sharing-in-physics-after-world-war-ii class=md-nav__link> $elemMatch example: Sharing in physics after World War II </a> </li> <li class=md-nav__item> <a href=#finding-a-substring-with-regex class=md-nav__link> Finding a substring with $regex </a> </li> <li class=md-nav__item> <a href=#beginning-and-ending class=md-nav__link> Beginning and ending </a> </li> <li class=md-nav__item> <a href=#regex-example-glenn-george-and-others-in-the-gs-crew class=md-nav__link> Regex example: Glenn, George, and others in the G.S. crew </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-projection-and-sorting class=md-nav__link> 2: Projection and Sorting </a> <nav class=md-nav aria-label="2: Projection and Sorting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-is-projection class=md-nav__link> What is "projection"? </a> </li> <li class=md-nav__item> <a href=#projection-in-mongodb class=md-nav__link> Projection in MongoDB </a> </li> <li class=md-nav__item> <a href=#missing-fields class=md-nav__link> Missing fields </a> </li> <li class=md-nav__item> <a href=#projection-example-shares-of-the-1963-prize-in-physics class=md-nav__link> Projection example: Shares of the 1963 prize in physics </a> </li> <li class=md-nav__item> <a href=#sorting-post-query-with-python class=md-nav__link> Sorting post-query with Python </a> </li> <li class=md-nav__item> <a href=#sorting-in-query-with-mongodb class=md-nav__link> Sorting in-query with MongoDB </a> </li> <li class=md-nav__item> <a href=#primary-and-secondary-sorting class=md-nav__link> Primary and secondary sorting </a> </li> <li class=md-nav__item> <a href=#sorting-example-what-the-sort class=md-nav__link> Sorting example: What the sort? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-indexing class=md-nav__link> 3: Indexing </a> <nav class=md-nav aria-label="3: Indexing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-are-indexes class=md-nav__link> What are indexes? </a> </li> <li class=md-nav__item> <a href=#when-to-use-indexes class=md-nav__link> When to use indexes? </a> </li> <li class=md-nav__item> <a href=#getting-index-information class=md-nav__link> Getting index information </a> </li> <li class=md-nav__item> <a href=#gauging-performance-before-indexing class=md-nav__link> Gauging performance before indexing </a> </li> <li class=md-nav__item> <a href=#adding-a-single-field-index class=md-nav__link> Adding a single-field index </a> </li> <li class=md-nav__item> <a href=#adding-a-compound-multiple-field-index class=md-nav__link> Adding a compound (multiple-field) index </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#1-working-with-distinct-values-elemmatch-and-regex class=md-nav__link> 1: Working with Distinct Values, $elemMatch, and Regex </a> <nav class=md-nav aria-label="1: Working with Distinct Values, $elemMatch, and Regex"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#an-exceptional-laureate class=md-nav__link> An exceptional laureate </a> </li> <li class=md-nav__item> <a href=#using-distinct class=md-nav__link> Using .distinct() </a> </li> <li class=md-nav__item> <a href=#all-prize-categories-vs-those-with-multi-winners class=md-nav__link> All prize categories vs those with multi-winners </a> </li> <li class=md-nav__item> <a href=#distinct-example-born-here-went-there class=md-nav__link> Distinct example: Born here, went there </a> </li> <li class=md-nav__item> <a href=#enter-elemmatch class=md-nav__link> Enter $elemMatch </a> </li> <li class=md-nav__item> <a href=#elemmatch-example-sharing-in-physics-after-world-war-ii class=md-nav__link> $elemMatch example: Sharing in physics after World War II </a> </li> <li class=md-nav__item> <a href=#finding-a-substring-with-regex class=md-nav__link> Finding a substring with $regex </a> </li> <li class=md-nav__item> <a href=#beginning-and-ending class=md-nav__link> Beginning and ending </a> </li> <li class=md-nav__item> <a href=#regex-example-glenn-george-and-others-in-the-gs-crew class=md-nav__link> Regex example: Glenn, George, and others in the G.S. crew </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-projection-and-sorting class=md-nav__link> 2: Projection and Sorting </a> <nav class=md-nav aria-label="2: Projection and Sorting"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-is-projection class=md-nav__link> What is "projection"? </a> </li> <li class=md-nav__item> <a href=#projection-in-mongodb class=md-nav__link> Projection in MongoDB </a> </li> <li class=md-nav__item> <a href=#missing-fields class=md-nav__link> Missing fields </a> </li> <li class=md-nav__item> <a href=#projection-example-shares-of-the-1963-prize-in-physics class=md-nav__link> Projection example: Shares of the 1963 prize in physics </a> </li> <li class=md-nav__item> <a href=#sorting-post-query-with-python class=md-nav__link> Sorting post-query with Python </a> </li> <li class=md-nav__item> <a href=#sorting-in-query-with-mongodb class=md-nav__link> Sorting in-query with MongoDB </a> </li> <li class=md-nav__item> <a href=#primary-and-secondary-sorting class=md-nav__link> Primary and secondary sorting </a> </li> <li class=md-nav__item> <a href=#sorting-example-what-the-sort class=md-nav__link> Sorting example: What the sort? </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#3-indexing class=md-nav__link> 3: Indexing </a> <nav class=md-nav aria-label="3: Indexing"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#what-are-indexes class=md-nav__link> What are indexes? </a> </li> <li class=md-nav__item> <a href=#when-to-use-indexes class=md-nav__link> When to use indexes? </a> </li> <li class=md-nav__item> <a href=#getting-index-information class=md-nav__link> Getting index information </a> </li> <li class=md-nav__item> <a href=#gauging-performance-before-indexing class=md-nav__link> Gauging performance before indexing </a> </li> <li class=md-nav__item> <a href=#adding-a-single-field-index class=md-nav__link> Adding a single-field index </a> </li> <li class=md-nav__item> <a href=#adding-a-compound-multiple-field-index class=md-nav__link> Adding a compound (multiple-field) index </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/materialsproject/workshop/edit/master/docs/primer/04_MongoDB_part2/lesson.ipynb title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <script src=https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js></script> <script>
(function() {
  function addWidgetsRenderer() {
    var mimeElement = document.querySelector('script[type="application/vnd.jupyter.widget-view+json"]');
    var scriptElement = document.createElement('script');
    var widgetRendererSrc = 'https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js';
    var widgetState;

    // Fallback for older version:
    try {
      widgetState = mimeElement && JSON.parse(mimeElement.innerHTML);

      if (widgetState && (widgetState.version_major < 2 || !widgetState.version_major)) {
        widgetRendererSrc = 'jupyter-js-widgets@*/dist/embed.js';
      }
    } catch(e) {}

    scriptElement.src = widgetRendererSrc;
    document.body.appendChild(scriptElement);
  }

  document.addEventListener('DOMContentLoaded', addWidgetsRenderer);
}());
</script> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h1 id=mongodb-part-2>MongoDB Part 2<a class=headerlink href=#mongodb-part-2 title="Permanent link">&para;</a></h1> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h2 id=1-working-with-distinct-values-elemmatch-and-regex>1: Working with Distinct Values, $elemMatch, and Regex<a class=headerlink href=#1-working-with-distinct-values-elemmatch-and-regex title="Permanent link">&para;</a></h2> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=an-exceptional-laureate>An exceptional laureate<a class=headerlink href=#an-exceptional-laureate title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>pymongo</span> <span class=kn>import</span> <span class=n>MongoClient</span>

<span class=n>client</span> <span class=o>=</span> <span class=n>MongoClient</span><span class=p>()</span>
<span class=n>db</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=n>nobel</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find_one</span><span class=p>({</span><span class=s2>&quot;prizes.2&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$exists&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=using-distinct>Using .distinct()<a class=headerlink href=#using-distinct title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=s2>&quot;gender&quot;</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper markdown=1> <div class=output markdown=1> <div class=output_area markdown=1> <div class="output_text output_subarea output_execute_result"> <pre>[]</pre> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> - A convenience method for a common aggregation (like <code>count_documents</code>) - We will not cover custom aggregations in this lesson, but the <code>aggregate</code> method is powerful. - <code>distinct</code> aggregation is efficient if there is a collection <em>index</em> on the field - We will learn how to create an index later in this lesson - No index needed here: collection fits in memory, has ≲ 1,000 documents </div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=all-prize-categories-vs-those-with-multi-winners>All prize categories vs those with multi-winners<a class=headerlink href=#all-prize-categories-vs-those-with-multi-winners title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=s2>&quot;prizes.category&quot;</span><span class=p>)</span>
</code></pre></div> </div> <div class=output_wrapper markdown=1> <div class=output markdown=1> <div class=output_area markdown=1> <div class="output_text output_subarea output_execute_result"> <pre>[]</pre> </div> </div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=s2>&quot;prizes.category&quot;</span><span class=p>,{</span><span class=s2>&quot;prizes.1&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$exists&quot;</span><span class=p>:</span> <span class=kc>True</span><span class=p>}})</span>
</code></pre></div> </div> <div class=output_wrapper markdown=1> <div class=output markdown=1> <div class=output_area markdown=1> <div class="output_text output_subarea output_execute_result"> <pre>[]</pre> </div> </div> </div> </div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=distinct-example-born-here-went-there>Distinct example: Born here, went there<a class=headerlink href=#distinct-example-born-here-went-there title="Permanent link">&para;</a></h3> <p>In which countries have USA-born laureates had affiliations for their prizes? </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span><span class=s2>&quot;prizes.affiliations.country&quot;</span><span class=p>,{</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>:</span><span class=s2>&quot;USA&quot;</span><span class=p>})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=enter-elemmatch>Enter $elemMatch<a class=headerlink href=#enter-elemmatch title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>count_documents</span><span class=p>({</span>
    <span class=s2>&quot;prizes&quot;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;physics&quot;</span><span class=p>,</span>
        <span class=s2>&quot;share&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span>
    <span class=p>}</span>
<span class=p>})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> Why is the above number zero? </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>count_documents</span><span class=p>({</span>
    <span class=s2>&quot;prizes.category&quot;</span><span class=p>:</span> <span class=s2>&quot;physics&quot;</span><span class=p>,</span>
    <span class=s2>&quot;prizes.share&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span>
<span class=p>})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>count_documents</span><span class=p>({</span>
    <span class=s2>&quot;prizes&quot;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s2>&quot;$elemMatch&quot;</span><span class=p>:</span> <span class=p>{</span>
            <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;physics&quot;</span><span class=p>,</span>
            <span class=s2>&quot;share&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span>
        <span class=p>}</span>
    <span class=p>}</span>
<span class=p>})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> Why are these numbers different? </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find_one</span><span class=p>({</span><span class=s2>&quot;firstname&quot;</span><span class=p>:</span> <span class=s2>&quot;Marie&quot;</span><span class=p>})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=elemmatch-example-sharing-in-physics-after-world-war-ii>$elemMatch example: Sharing in physics after World War II<a class=headerlink href=#elemmatch-example-sharing-in-physics-after-world-war-ii title="Permanent link">&para;</a></h3> <p>What is the approximate ratio of the number of laureates who won an <em>unshared</em>, i.e.</p> <div class=codehilite><pre><span></span><code><span class=err>{&quot;share&quot;: &quot;1&quot;}</span>
</code></pre></div> <p>, prize in physics after World War II, i.e.</p> <div class=codehilite><pre><span></span><code><span class=err>{&quot;year&quot;: {&quot;$gte&quot;: &quot;1945&quot;}}</span>
</code></pre></div> <p>, to the number of laureates who won a <em>shared</em> prize in physics after World War II? </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=c1># Save a filter for laureates with unshared prizes</span>
<span class=n>unshared</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s2>&quot;prizes&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$elemMatch&quot;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;physics&quot;</span><span class=p>,</span>
        <span class=s2>&quot;share&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span><span class=p>,</span>
        <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$gte&quot;</span><span class=p>:</span> <span class=s2>&quot;1945&quot;</span><span class=p>},</span>
    <span class=p>}}}</span>

<span class=c1># Save a filter for laureates with shared prizes</span>
<span class=n>shared</span> <span class=o>=</span> <span class=p>{</span>
    <span class=s2>&quot;prizes&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$elemMatch&quot;</span><span class=p>:</span> <span class=p>{</span>
        <span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;physics&quot;</span><span class=p>,</span>
        <span class=s2>&quot;share&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$gt&quot;</span><span class=p>:</span> <span class=s2>&quot;1&quot;</span><span class=p>},</span>
        <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$gte&quot;</span><span class=p>:</span> <span class=s2>&quot;1945&quot;</span><span class=p>},</span>
    <span class=p>}}}</span>

<span class=n>ratio</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>count_documents</span><span class=p>(</span><span class=n>unshared</span><span class=p>)</span> <span class=o>/</span> <span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>count_documents</span><span class=p>(</span><span class=n>shared</span><span class=p>)</span>
<span class=nb>print</span><span class=p>(</span><span class=n>ratio</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=finding-a-substring-with-regex>Finding a substring with $regex<a class=headerlink href=#finding-a-substring-with-regex title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span>
    <span class=s2>&quot;bornCountry&quot;</span><span class=p>,</span>
    <span class=p>{</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$regex&quot;</span><span class=p>:</span> <span class=s2>&quot;Poland&quot;</span><span class=p>}})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=beginning-and-ending>Beginning and ending<a class=headerlink href=#beginning-and-ending title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span>
    <span class=s2>&quot;bornCountry&quot;</span><span class=p>,</span> 
     <span class=p>{</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$regex&quot;</span><span class=p>:</span><span class=s2>&quot;^Poland&quot;</span><span class=p>}})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span>
    <span class=s2>&quot;bornCountry&quot;</span><span class=p>,</span> 
     <span class=p>{</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$regex&quot;</span><span class=p>:</span><span class=s2>&quot;^Poland \(now&quot;</span><span class=p>}})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>distinct</span><span class=p>(</span>
    <span class=s2>&quot;bornCountry&quot;</span><span class=p>,</span> 
     <span class=p>{</span><span class=s2>&quot;bornCountry&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$regex&quot;</span><span class=p>:</span><span class=s2>&quot;now Poland\)$&quot;</span><span class=p>}})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=regex-example-glenn-george-and-others-in-the-gs-crew>Regex example: Glenn, George, and others in the G.S. crew<a class=headerlink href=#regex-example-glenn-george-and-others-in-the-gs-crew title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> There are two laureates with Berkeley, California as a prize affiliation city that have the initials G.S. - Glenn Seaborg and George Smoot.</p> <p>How many laureates in total have a first name beginning with "G" and a surname beginning with "S"? </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>count_documents</span><span class=p>({</span><span class=s2>&quot;firstname&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$regex&quot;</span><span class=p>:</span><span class=s2>&quot;^G&quot;</span><span class=p>},</span> <span class=s2>&quot;surname&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$regex&quot;</span><span class=p>:</span><span class=s2>&quot;^S&quot;</span><span class=p>}})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h2 id=2-projection-and-sorting>2: Projection and Sorting<a class=headerlink href=#2-projection-and-sorting title="Permanent link">&para;</a></h2> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=what-is-projection>What is "projection"?<a class=headerlink href=#what-is-projection title="Permanent link">&para;</a></h3> <ul> <li>reducing data to fewer dimensions</li> <li>Asking certain data to "speak up"! </div> </div></li> </ul> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> <img alt src=../assets/map-projections.jpg> </div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=projection-in-mongodb>Projection in MongoDB<a class=headerlink href=#projection-in-mongodb title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> When using <code>db.collection.find()</code>, the first argument is the filter and the second is the projection. </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find</span><span class=p>({},</span> <span class=p>{})</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> Since <code>db.collection.find()</code> returns a cursor, we need to make it into a list: </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find</span><span class=p>({},{}))[:</span><span class=mi>3</span><span class=p>]</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> An empty projection dictionary by default only displays the entry <code>"_id"</code> field. To project out the prizes.affiliation field without the <code>"_id"</code> field, we would use a projection equal to <code>{"prizes.affiliations": 1, "_id": 0}</code>. </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find</span><span class=p>({},{</span><span class=s2>&quot;prizes.affiliations&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}))[:</span><span class=mi>3</span><span class=p>]</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> where the <code>1</code> value turns on <code>"prizes.affiliations"</code> and the <code>0</code> value turns off <code>"_id"</code>. </div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=missing-fields>Missing fields<a class=headerlink href=#missing-fields title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&quot;gender&quot;</span><span class=p>:</span> <span class=s2>&quot;org&quot;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&quot;firstname&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;born&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=projection-example-shares-of-the-1963-prize-in-physics>Projection example: Shares of the 1963 prize in physics<a class=headerlink href=#projection-example-shares-of-the-1963-prize-in-physics title="Permanent link">&para;</a></h3> <p>Let's examine the laureates of the 1963 prize in physics and how they split the prize. Here is a query without projection:</p> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&quot;prizes&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$elemMatch&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;physics&quot;</span><span class=p>,</span> <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=s2>&quot;1963&quot;</span><span class=p>}}})</span>
</code></pre></div> <p>How would we fetch the laureates' full names and prize share info? </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>projection</span> <span class=o>=</span> <span class=p>{</span><span class=s2>&quot;firstname&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;surname&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;prizes.share&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}</span>

<span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&quot;prizes&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$elemMatch&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;physics&quot;</span><span class=p>,</span> <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=s2>&quot;1963&quot;</span><span class=p>}}},</span> <span class=n>projection</span><span class=p>))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=sorting-post-query-with-python>Sorting post-query with Python<a class=headerlink href=#sorting-post-query-with-python title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=kn>from</span> <span class=nn>operator</span> <span class=kn>import</span> <span class=n>itemgetter</span>

<span class=n>docs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;physics&quot;</span><span class=p>},</span>
                           <span class=p>{</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>}))</span>

<span class=n>docs</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>docs</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=n>itemgetter</span><span class=p>(</span><span class=s2>&quot;year&quot;</span><span class=p>))</span>

<span class=nb>print</span><span class=p>([</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;year&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>docs</span><span class=p>][:</span><span class=mi>5</span><span class=p>])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>docs</span> <span class=o>=</span> <span class=nb>sorted</span><span class=p>(</span><span class=n>docs</span><span class=p>,</span> <span class=n>key</span><span class=o>=</span><span class=n>itemgetter</span><span class=p>(</span><span class=s2>&quot;year&quot;</span><span class=p>),</span> <span class=n>reverse</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>

<span class=nb>print</span><span class=p>([</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;year&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>docs</span><span class=p>][:</span><span class=mi>5</span><span class=p>])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=sorting-in-query-with-mongodb>Sorting in-query with MongoDB<a class=headerlink href=#sorting-in-query-with-mongodb title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>cursor</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;physics&quot;</span><span class=p>},</span>
                        <span class=p>{</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span>
                        <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)])</span>

<span class=nb>print</span><span class=p>([</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;year&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>cursor</span><span class=p>][:</span><span class=mi>5</span><span class=p>])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>cursor</span> <span class=o>=</span> <span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;physics&quot;</span><span class=p>},</span>
                        <span class=p>{</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>},</span>
                        <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)])</span>

<span class=nb>print</span><span class=p>([</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;year&quot;</span><span class=p>]</span> <span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>cursor</span><span class=p>][:</span><span class=mi>5</span><span class=p>])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=primary-and-secondary-sorting>Primary and secondary sorting<a class=headerlink href=#primary-and-secondary-sorting title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>(</span>
        <span class=p>{</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$gt&quot;</span><span class=p>:</span> <span class=s2>&quot;1966&quot;</span><span class=p>,</span> <span class=s2>&quot;$lt&quot;</span><span class=p>:</span> <span class=s2>&quot;1970&quot;</span><span class=p>}},</span>
        <span class=p>{</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
        <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;category&quot;</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)]):</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;year&quot;</span><span class=p>],</span><span class=n>doc</span><span class=p>[</span><span class=s2>&quot;category&quot;</span><span class=p>])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=sorting-example-what-the-sort>Sorting example: What the sort?<a class=headerlink href=#sorting-example-what-the-sort title="Permanent link">&para;</a></h3> <p>This block prints out the first five projections of a sorted query. What "sort" argument fills the blank?</p> <p><div class=highlight><pre><span></span><code><span class=n>docs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find</span><span class=p>(</span>
    <span class=p>{</span><span class=s2>&quot;born&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$gte&quot;</span><span class=p>:</span> <span class=s2>&quot;1900&quot;</span><span class=p>},</span> <span class=s2>&quot;prizes.year&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$gte&quot;</span><span class=p>:</span> <span class=s2>&quot;1954&quot;</span><span class=p>},</span> <span class=s2>&quot;gender&quot;</span><span class=p>:{</span><span class=s2>&quot;$in&quot;</span><span class=p>:[</span><span class=s2>&quot;male&quot;</span><span class=p>,</span><span class=s2>&quot;female&quot;</span><span class=p>]}},</span>
    <span class=p>{</span><span class=s2>&quot;born&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;prizes.year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
    <span class=n>sort</span> <span class=o>=</span> <span class=n>____</span><span class=p>))</span>
<span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>docs</span><span class=p>[:</span><span class=mi>5</span><span class=p>]:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</code></pre></div> <div class=highlight><pre><span></span><code>{&#39;born&#39;: &#39;1916-08-25&#39;, &#39;prizes&#39;: [{&#39;year&#39;: &#39;1954&#39;}]}
{&#39;born&#39;: &#39;1915-06-15&#39;, &#39;prizes&#39;: [{&#39;year&#39;: &#39;1954&#39;}]}
{&#39;born&#39;: &#39;1901-02-28&#39;, &#39;prizes&#39;: [{&#39;year&#39;: &#39;1954&#39;}, {&#39;year&#39;: &#39;1962&#39;}]}
{&#39;born&#39;: &#39;1913-07-12&#39;, &#39;prizes&#39;: [{&#39;year&#39;: &#39;1955&#39;}]}
{&#39;born&#39;: &#39;1911-01-26&#39;, &#39;prizes&#39;: [{&#39;year&#39;: &#39;1955&#39;}]}
</code></pre></div> </div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> Primary sorting is ascending by <code>"prizes.year"</code>. Secondary sort is descending by <code>"born"</code>. Thus, sort=<code>[("prizes.year",1),("born",-1)]</code>. </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>my_sort</span> <span class=o>=</span> <span class=p>[(</span><span class=s2>&quot;prizes.year&quot;</span><span class=p>,</span><span class=mi>1</span><span class=p>),(</span><span class=s2>&quot;born&quot;</span><span class=p>,</span><span class=o>-</span><span class=mi>1</span><span class=p>)]</span>

<span class=n>docs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>laureates</span><span class=o>.</span><span class=n>find</span><span class=p>(</span>
    <span class=p>{</span><span class=s2>&quot;born&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$gte&quot;</span><span class=p>:</span> <span class=s2>&quot;1900&quot;</span><span class=p>},</span> <span class=s2>&quot;prizes.year&quot;</span><span class=p>:</span> <span class=p>{</span><span class=s2>&quot;$gte&quot;</span><span class=p>:</span> <span class=s2>&quot;1954&quot;</span><span class=p>},</span> <span class=s2>&quot;gender&quot;</span><span class=p>:{</span><span class=s2>&quot;$in&quot;</span><span class=p>:[</span><span class=s2>&quot;male&quot;</span><span class=p>,</span><span class=s2>&quot;female&quot;</span><span class=p>]}},</span>
    <span class=p>{</span><span class=s2>&quot;born&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;prizes.year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
    <span class=n>sort</span> <span class=o>=</span> <span class=n>my_sort</span><span class=p>))</span>
<span class=k>for</span> <span class=n>doc</span> <span class=ow>in</span> <span class=n>docs</span><span class=p>[:</span><span class=mi>5</span><span class=p>]:</span>
    <span class=nb>print</span><span class=p>(</span><span class=n>doc</span><span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h2 id=3-indexing>3: Indexing<a class=headerlink href=#3-indexing title="Permanent link">&para;</a></h2> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=what-are-indexes>What are indexes?<a class=headerlink href=#what-are-indexes title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> <img alt src=../assets/index-steps-1.png> </div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> <img alt src=../assets/index-steps-2.png> </div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> <img alt src=../assets/index-steps-3.png> </div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=when-to-use-indexes>When to use indexes?<a class=headerlink href=#when-to-use-indexes title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> - Queries with high specificity - Large documents - Large collections </div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=getting-index-information>Getting index information<a class=headerlink href=#getting-index-information title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>index_information</span><span class=p>()</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=gauging-performance-before-indexing>Gauging performance before indexing<a class=headerlink href=#gauging-performance-before-indexing title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> Jupyter Notebook <code>%%timeit</code>magic (same as <code>python -m timeit "[expression]"</code>) </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=n>docs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=s2>&quot;1901&quot;</span><span class=p>}))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=n>docs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({},</span> <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)]))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=n>docs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({},</span> <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)]))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=adding-a-single-field-index>Adding a single-field index<a class=headerlink href=#adding-a-single-field-index title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> - index model: list of <code>(field, direction)</code>pairs. - directions: 1 (ascending) and -1 (descending) </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>create_index</span><span class=p>([(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>index_information</span><span class=p>()</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=n>docs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=s2>&quot;1901&quot;</span><span class=p>}))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=n>docs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({},</span> <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)]))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=n>docs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({},</span> <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)]))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>drop_index</span><span class=p>([(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>create_index</span><span class=p>([(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=n>docs</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({},</span> <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)]))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>drop_index</span><span class=p>([(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=o>-</span><span class=mi>1</span><span class=p>)])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1></p> <h3 id=adding-a-compound-multiple-field-index>Adding a compound (multiple-field) index<a class=headerlink href=#adding-a-compound-multiple-field-index title="Permanent link">&para;</a></h3> <p></div> </div></p> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> - index "covering" a query with projection </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;economics&quot;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>create_index</span><span class=p>([(</span><span class=s2>&quot;category&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=nb>list</span><span class=p>(</span><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find</span><span class=p>({</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;economics&quot;</span><span class=p>},</span> <span class=p>{</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>}))</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>drop_index</span><span class=p>([(</span><span class=s2>&quot;category&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing text_cell rendered"> <p><div class=inner_cell markdown=1> <div class="text_cell_render border-box-sizing rendered_html" markdown=1> - index "covering" a query with projection and sorting </div> </div></p> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find_one</span><span class=p>(</span>
    <span class=p>{</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;economics&quot;</span><span class=p>},</span>
    <span class=p>{</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
    <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)]</span>
<span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>create_index</span><span class=p>([(</span><span class=s2>&quot;category&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)])</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=o>%%</span><span class=n>timeit</span>
<span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>find_one</span><span class=p>(</span>
    <span class=p>{</span><span class=s2>&quot;category&quot;</span><span class=p>:</span> <span class=s2>&quot;economics&quot;</span><span class=p>},</span>
    <span class=p>{</span><span class=s2>&quot;year&quot;</span><span class=p>:</span> <span class=mi>1</span><span class=p>,</span> <span class=s2>&quot;_id&quot;</span><span class=p>:</span> <span class=mi>0</span><span class=p>},</span>
    <span class=n>sort</span><span class=o>=</span><span class=p>[(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)]</span>
<span class=p>)</span>
</code></pre></div> </div> </div> <div class="cell border-box-sizing code_cell rendered"> <div class=input> <div class=highlight><pre><span></span><code><span class=n>db</span><span class=o>.</span><span class=n>prizes</span><span class=o>.</span><span class=n>drop_index</span><span class=p>([(</span><span class=s2>&quot;category&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=p>(</span><span class=s2>&quot;year&quot;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)])</span>
</code></pre></div> </div> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../../03_MongoDB_part1/lessons/ title="Intro to MongoDB" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Intro to MongoDB </div> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Built by The Materials Project </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../../assets/javascripts/vendor.92ffa368.min.js></script> <script src=../../../assets/javascripts/bundle.5123e3d4.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../../..",
          features: [],
          search: Object.assign({
            worker: "../../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>